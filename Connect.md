# ESP32 E-Paper智能设备接线图

本文档提供了ESP32智能设备的所有模块接线方式，包括各类传感器和显示模块。

## 硬件清单

1. ESP32开发板 (ESP32-DOIT DevKit V1)
2. SSD1306 OLED显示屏 (128x64像素) - I2C接口
3. BH1750环境光传感器 - I2C接口
4. MQ2气体传感器 - 模拟接口
5. WS2812B RGB LED - 数字接口
6. DHT11温湿度传感器 - 数字接口
7. 外部通信设备 (连接到串口2)
8. E-Paper墨水屏 - SPI接口

## 接线详情

### 1. SSD1306 OLED显示屏

| ESP32引脚 | OLED引脚 | 说明 |
|-----------|--------|------|
| GPIO21    | SDA    | I2C数据线 |
| GPIO22    | SCL    | I2C时钟线 |
| 3.3V      | VCC    | 电源 |
| GND       | GND    | 接地 |

*I2C地址: 0x3C*

### 2. BH1750环境光传感器

| ESP32引脚 | BH1750引脚 | 说明 |
|-----------|---------|------|
| GPIO4     | SDA     | I2C数据线 |
| GPIO5     | SCL     | I2C时钟线 |
| 3.3V      | VCC     | 电源 |
| GND       | GND     | 接地 |

*注意: BH1750使用独立的I2C总线*

### 3. MQ2气体传感器

| ESP32引脚 | MQ2引脚 | 说明 |
|-----------|-------|------|
| GPIO34    | AO    | 模拟输出 |
| 5V        | VCC   | 电源 |
| GND       | GND   | 接地 |

*注意: MQ2传感器需要5V供电*

### 4. WS2812B RGB LED

| ESP32引脚 | WS2812B引脚 | 说明 |
|-----------|----------|------|
| GPIO2     | DIN      | 数据输入 |
| 5V        | VCC      | 电源 |
| GND       | GND      | 接地 |

*注意: 项目配置为控制1个WS2812B LED*

### 5. DHT11温湿度传感器

| ESP32引脚 | DHT11引脚 | 说明 |
|-----------|---------|------|
| GPIO27    | DATA    | 数据 |
| 3.3V      | VCC     | 电源 |
| GND       | GND     | 接地 |

*注意: DHT11原先使用的GPIO4与BH1750的SDA引脚冲突，已更改为GPIO27*

### 6. 外部串口通信 (Serial2)

| ESP32引脚 | 外部设备 | 说明 |
|-----------|--------|------|
| GPIO16    | RX     | 接收数据 (ESP32角度) |
| GPIO17    | TX     | 发送数据 (ESP32角度) |
| GND       | GND    | 共地 |

*通信参数: 9600波特率, 8位数据位, 无校验位, 1位停止位*

### 7. E-Paper墨水屏 (SPI接口)

| ESP32引脚 | E-Paper引脚 | 说明 |
|-----------|-----------|------|
| GPIO14    | BUSY      | 忙状态指示 |
| GPIO15    | RST       | 复位 |
| GPIO13    | DC        | 数据/命令选择 |
| GPIO12    | CS        | 片选 |
| GPIO23    | MOSI      | SPI主机输出 |
| GPIO19    | MISO      | SPI主机输入（某些E-Paper型号需要） |
| GPIO18    | CLK       | SPI时钟 |
| 3.3V      | VCC       | 电源 |
| GND       | GND       | 接地 |

*注意: E-Paper需要3.3V供电，不能使用5V，否则会损坏屏幕*

## 引脚冲突说明

已解决的引脚冲突：
- 之前的GPIO4引脚冲突（DHT11和BH1750共用）已通过将DHT11数据引脚重新分配到GPIO27解决
- 此方案保留了BH1750的原有I2C引脚配置（GPIO4/GPIO5），同时确保DHT11可以正常工作

## 电源需求

- **5V需求设备**: WS2812B LED, MQ2气体传感器
- **3.3V需求设备**: ESP32核心, OLED显示屏, BH1750光线传感器, DHT11温湿度传感器, E-Paper墨水屏

## 接线图

```
ESP32 DOIT DevKit V1
┌────────────────────────────┐
│                            │
│           [USB]            │
│                            │
└────────┬──────────────┬────┘
         │              │
         │              │
     3V3 ●              ● 5V
         │              │
         │              │     ┌─────────────┐
     GND ●──────────────┼─────┤ OLED SSD1306│
         │              │     │             │
 GPIO21  ●──────────────┼─────┤ SDA         │
         │              │     │             │
 GPIO22  ●──────────────┼─────┤ SCL         │
         │              │     │             │
         │              └─────┤ VCC         │
         │                    └─────────────┘
         │
         │                    ┌─────────────┐
         ├────────────────────┤ BH1750      │
         │                    │             │
  GPIO4  ●────────────────────┤ SDA         │
         │                    │             │
  GPIO5  ●────────────────────┤ SCL         │
         │                    │             │
     GND ●────────────────────┤ GND         │
         │                    │             │
     3V3 ●────────────────────┤ VCC         │
         │                    └─────────────┘
         │
         │                    ┌─────────────┐
 GPIO34  ●────────────────────┤ MQ2 AO      │
         │                    │             │
     GND ●────────────────────┤ GND         │
         │                    │             │
      5V ●────────────────────┤ VCC         │
         │                    └─────────────┘
         │
         │                    ┌─────────────┐
  GPIO2  ●────────────────────┤ WS2812B DIN │
         │                    │             │
     GND ●────────────────────┤ GND         │
         │                    │             │
      5V ●────────────────────┤ VCC         │
         │                    └─────────────┘
         │
         │                    ┌─────────────┐
 GPIO27  ●────────────────────┤ DHT11 DATA  │
         │                    │             │
     GND ●────────────────────┤ GND         │
         │                    │             │
     3V3 ●────────────────────┤ VCC         │
         │                    └─────────────┘
         │
         │                    ┌─────────────┐
 GPIO16  ●────────────────────┤ 外部设备 RX  │
         │                    │             │
 GPIO17  ●────────────────────┤ 外部设备 TX  │
         │                    │             │
     GND ●────────────────────┤ GND         │
         │                    └─────────────┘
         │
         │                    ┌─────────────┐
 GPIO14  ●────────────────────┤ E-Paper BUSY│
         │                    │             │
 GPIO15  ●────────────────────┤ E-Paper RST │
         │                    │             │
 GPIO13  ●────────────────────┤ E-Paper DC  │
         │                    │             │
 GPIO12  ●────────────────────┤ E-Paper CS  │
         │                    │             │
 GPIO23  ●────────────────────┤ E-Paper MOSI│
         │                    │             │
 GPIO19  ●────────────────────┤ E-Paper MISO│
         │                    │             │
 GPIO18  ●────────────────────┤ E-Paper CLK │
         │                    │             │
     3V3 ●────────────────────┤ VCC         │
         │                    │             │
     GND ●────────────────────┤ GND         │
         │                    └─────────────┘
         │
    [其他引脚]
         │
└────────┴────────────────────┘
```

## 注意事项

1. **硬件更新**: DHT11传感器已从GPIO4移至GPIO27，确保实际硬件接线与此配置一致。
2. **电源**: 确保ESP32有足够的电源供应所有设备，特别是WS2812B LED和MQ2气体传感器。
3. **I2C地址**: 确保在同一I2C总线上的设备有不同的I2C地址，以避免冲突。
4. **线路长度**: 对于I2C设备，连接线不宜过长，以避免信号衰减。
5. **E-Paper墨水屏**: 墨水屏刷新速度较慢，项目中设置了30秒刷新一次，避免频繁刷新。
6. **初次使用MQ2**: MQ2气体传感器首次使用需要24小时预热时间，之后每次上电需10分钟预热才能获得准确数值。

## 建议改进

1. **已实施的改进**:
   - DHT11的数据引脚已经从GPIO4更改为GPIO27，解决了与BH1750的引脚冲突
   - 增加了E-Paper墨水屏MISO引脚的支持，提高了兼容性

2. **电源保护**:
   - 考虑为WS2812B LED添加一个级联电容(100μF)，以平滑电源
   - 为模拟传感器添加滤波电容，以提高测量稳定性
   - 建议使用5V/2A以上的电源适配器，确保供电充足

3. **扩展建议**:
   - 可考虑添加一个按钮用于手动刷新E-Paper显示
   - 添加电池供电支持，利用ESP32和E-Paper的低功耗特性
   - 设计一个专用PCB，减少接线复杂度，提高可靠性
   - 增加备用电源切换电路，确保在主电源中断时能保持工作
